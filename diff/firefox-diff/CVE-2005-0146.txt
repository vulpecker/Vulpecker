--- editor/libeditor/text/nsEditorEventListeners.cpp	27 Feb 2004 17:17:28 -0000	1.222
+++ editor/libeditor/text/nsEditorEventListeners.cpp	24 Oct 2004 06:25:03 -0000
@@ -276,20 +276,23 @@ nsTextEditorMouseListener::HandleEvent(n
   return NS_OK;
 }
 
 
 
 nsresult
 nsTextEditorMouseListener::MouseClick(nsIDOMEvent* aMouseEvent)
 {
   nsCOMPtr<nsIDOMMouseEvent> mouseEvent ( do_QueryInterface(aMouseEvent) );
-  if (!mouseEvent) {
-    //non-ui event passed in.  bad things.
+  nsCOMPtr<nsIDOMNSEvent> nsEvent ( do_QueryInterface(aMouseEvent) );
+  PRBool isTrusted = PR_FALSE;
+  if (!mouseEvent || !nsEvent ||
+      NS_FAILED(nsEvent->GetIsTrusted(&isTrusted)) || !isTrusted) {
+    //non-ui, or non-trusted evet passed in.  bad things.
     return NS_OK;
   }
 
   nsCOMPtr<nsIEditor> editor = do_QueryInterface(mEditor);
   if (!editor) { return NS_OK; }
 
   // If we got a mouse down inside the editing area, we should force the 
   // IME to commit before we change the cursor position
   nsCOMPtr<nsIEditorIMESupport> imeEditor = do_QueryInterface(mEditor);
