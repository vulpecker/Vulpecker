--- pango/glyphstring.c.1.20.5	2009-02-26 16:01:37.000000000 +1300
+++ pango/glyphstring.c	2009-02-27 09:57:59.000000000 +1300
@@ -56,24 +56,39 @@ pango_glyph_string_new (void)
 void
 pango_glyph_string_set_size (PangoGlyphString *string, gint new_len)
 {
   g_return_if_fail (new_len >= 0);
 
   while (new_len > string->space)
     {
       if (string->space == 0)
-	string->space = 1;
+	{
+	  string->space = 1;
+	}
       else
-	string->space *= 2;
-
-      if (string->space < 0)
 	{
-	  g_warning ("glyph string length overflows maximum integer size, truncated");
-	  new_len = string->space = G_MAXINT - 8;
+	  const guint max_space =
+	    MIN (G_MAXINT, G_MAXSIZE / sizeof(PangoGlyphInfo));
+
+	  guint more_space = (guint)string->space * 2;
+
+	  if (more_space > max_space)
+	    {
+	      more_space = max_space;
+
+	      if ((guint)new_len > max_space)
+		{
+		  // abort
+		  g_error ("%s: failed to allocate glyph string of length %i\n",
+			   G_STRLOC, new_len);
+		}
+	    }
+
+	  string->space = more_space;
 	}
     }
 
   string->glyphs = g_realloc (string->glyphs, string->space * sizeof (PangoGlyphInfo));
   string->log_clusters = g_realloc (string->log_clusters, string->space * sizeof (gint));
   string->num_glyphs = new_len;
 }
 
